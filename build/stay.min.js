/**
 * stay v0.1.0 build Sep 16 2015
 * https://github.com/vanruesc/stay
 * Copyright 2015 Raoul van Rueschen, Apache-2.0
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Stay=e()}}(function(){var e;return function t(e,i,s){function n(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(o)return o(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var l=i[r]={exports:{}};e[r][0].call(l.exports,function(t){var i=e[r][1][t];return n(i?i:t)},l,l.exports,t,e,i,s)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(t,i,s){!function(t,n){"object"==typeof s&&"undefined"!=typeof i?i.exports=n():"function"==typeof e&&e.amd?e(n):t.EventDispatcher=n()}(this,function(){"use strict";function e(){this._listeners={}}return e.prototype.apply=function(t){t._listeners={},t.addEventListener=e.prototype.addEventListener,t.hasEventListener=e.prototype.hasEventListener,t.removeEventListener=e.prototype.removeEventListener,t.dispatchEvent=e.prototype.dispatchEvent},e.prototype.addEventListener=function(e,t){void 0===this._listeners[e]&&(this._listeners[e]=[]),-1===this._listeners[e].indexOf(t)&&this._listeners[e].push(t)},e.prototype.hasEventListener=function(e,t){return void 0!==this._listeners[e]&&-1!==this._listeners[e].indexOf(t)},e.prototype.removeEventListener=function(e,t){var i,s;s=this._listeners[e],void 0!==s&&(i=s.indexOf(t),-1!==i&&s.splice(i,1))},e.prototype.dispatchEvent=function(e){var t,i,s;if(s=this._listeners[e.type],void 0!==s)for(e.target=this,t=0,i=s.length;i>t;++t)s[t].call(this,e)},e})},{}],2:[function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}function n(e){var t=document.createElement("a");return t.href=e,t}function o(e){var t=this;if(a["default"].call(this),this.local=new RegExp("^"+location.protocol+"//"+location.host),this.responseFields=["main","navigation","footer"],this.infix="/json",this.timeoutPost=6e4,this.timeoutGet=5e3,this.autoUpdate=!0,void 0!==e&&(void 0!==e.responseFields&&(this.responseFields=e.responseFields),void 0!==e.infix&&(this.infix=e.infix),void 0!==e.timeoutPost&&(this.timeoutPost=e.timeoutPost),void 0!==e.timeoutGet&&(this.timeoutGet=e.timeoutGet),void 0!==e.autoUpdate&&(this.autoUpdate=e.autoUpdate)),this.locked=!1,this.backForward=!1,this.absolutePath=null,this.containers=[],this.intermediateContainer=null,this.navigationListeners=[],this.eventNavigate={type:"navigate"},this.eventReceive={type:"receive",response:null,status:0},this.eventLoad={type:"load"},void 0===XMLHttpRequest)throw new Error("XMLHttpRequest functionality not available.");this.xhr=new XMLHttpRequest,this.xhr.addEventListener("readystatechange",function(e){t._handleResponse(this,e)}),this.xhr.addEventListener("timeout",function(){var e={};t.responseFields.length&&(e.title="Timeout Error",e[t.responseFields[0]]=o.Error.TIMEOUT,t.locked=!0,t.update(e))}),window.addEventListener("popstate",function(e){t.locked||null===e.state||(t.backForward=!0,t._navigate({href:e.state.url}))}),this._switchPage=function(e){var i=void 0!==e.preventDefault,s=!1;return"submit"===e.type?s=!0:e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||(void 0!==e.which?s=1===e.which:void 0!==e.button&&(s=0===e.button)),s&&(i&&e.preventDefault(),t.locked||t._navigate(this)),!(s&&!i)},this.update({title:document.title,url:window.location.href}),this._updateListeners()}Object.defineProperty(i,"__esModule",{value:!0}),i["default"]=o;var r=e("@zayesh/eventdispatcher"),a=s(r);o.prototype=Object.create(a["default"].prototype),o.prototype.constructor=o,o.prototype.addResponseField=function(e){-1===this.responseFields.indexOf(e)&&this.responseFields.push(e)},o.prototype.removeResponseField=function(e){var t=this.responseFields.indexOf(e);-1!==t&&this.responseFields.splice(t,1)},o.prototype._navigate=function(e){var t,i,s,o=!1;this.locked=!0,e.action?(this.absolutePath=e.action,t=new FormData(e),o=!0):this.absolutePath=e.href,i=n(this.absolutePath).pathname,"/"!==i.charAt(0)&&(i="/"+i),s="/"===i?this.absolutePath.slice(0,this.absolutePath.length-1)+this.infix+i:this.absolutePath.replace(new RegExp(i),this.infix+i),this.eventNavigate.method=o?"POST":"GET",this.dispatchEvent(this.eventNavigate),this.xhr.open(this.eventNavigate.method,s,!0),o?(this.xhr.timeout=this.timeoutPost,this.xhr.send(t)):(this.xhr.timeout=this.timeoutGet,this.xhr.send())},o.prototype._updateView=function(e){var t,i,s,n,o=!1;if(null===this.intermediateContainer)this.intermediateContainer=document.createElement("div");else for(;this.intermediateContainer.children.length>0;)this.intermediateContainer.removeChild(this.intermediateContainer.children[0]);for(t=0,i=this.responseFields.length;i>t;++t)if(s=this.containers[this.responseFields[t]],s||(s=this.containers[this.responseFields[t]]=document.getElementById(this.responseFields[t])),n=e[this.responseFields[t]]){for(;s.children.length>0;)s.removeChild(s.children[0]);for(this.intermediateContainer.innerHTML=n;this.intermediateContainer.children.length>0;)s.appendChild(this.intermediateContainer.children[0]);o=!0}o&&this._updateListeners()},o.prototype._updateListeners=function(){var e,t,i=this,s=document.getElementsByTagName("a"),n=document.getElementsByTagName("form");for(e=0,t=this.navigationListeners.length;t>e;++e)this.navigationListeners[e][0].removeEventListener(this.navigationListeners[e][1],i._switchPage);for(e=0,t=s.length;t>e;++e)this.local.test(s[e].href)&&(s[e].addEventListener("click",i._switchPage),this.navigationListeners.push([s[e],"click"]));for(e=0,t=n.length;t>e;++e)this.local.test(n[e].action)&&(n[e].addEventListener("submit",i._switchPage),this.navigationListeners.push([n[e],"submit"]))},o.prototype.update=function(e){this._updateView(e),document.title=e.title,e.url&&(this.absolutePath=e.url.replace(this.infix,"")),this.backForward?this.backForward=!1:history.pushState({url:this.absolutePath},e.title,this.absolutePath),this.eventReceive.response=null,this.dispatchEvent(this.eventLoad),this.locked=!1},o.prototype._handleResponse=function(e){var t={};if(0===this.responseFields.length)t.title="Setup Error",t[this.responseFields[0]]=o.Error.NO_RESPONSE_FIELDS;else if(4===e.readyState){try{t=JSON.parse(e.responseText)}catch(i){t.title="Parse Error",t[this.responseFields[0]]=o.Error.UNPARSABLE,void 0!==console&&console.log(i)}t.url=e.responseURL,this.eventReceive.status=e.status,this.eventReceive.response=t,this.dispatchEvent(this.eventReceive),this.autoUpdate&&this.update(t)}},o.Error=Object.freeze({TIMEOUT:"<p>The server didn't respond in time. Please try again later!</p>",UNPARSABLE:"<p>The received content could not be parsed.</p>",NO_RESPONSE_FIELDS:"<p>No response fields have been specified!</p>"}),t.exports=i["default"]},{"@zayesh/eventdispatcher":1}]},{},[2])(2)});