/**
 * stay build 21.06.2015
 *
 * Copyright 2015 Raoul van RÃ¼schen
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Stay=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(){this._listeners={}}d.prototype.addEventListener=function(a,b){var c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b)},d.prototype.hasEventListener=function(a,b){var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},d.prototype.removeEventListener=function(a,b){var c,d=this._listeners,e=d[a];void 0!==e&&(c=e.indexOf(b),-1!==c&&e.splice(c,1))},d.prototype.dispatchEvent=function(a){var b,c,d,e=this._listeners,f=e[a.type];if(void 0!==f){for(a.target=this,b=[],c=f.length,d=0;c>d;++d)b[d]=f[d];for(d=0;c>d;++d)b[d].call(this,a)}},b.exports=d},{}],2:[function(a,b,c){"use strict";function d(a){var b=document.createElement("a");return b.href=a,b}function Stay(a){var b=this;if(e.call(this),void 0!==a&&(this.contents=void 0!==a.contents?a.contents:null,this.navigation=void 0!==a.navigation?a.navigation:null,this.infix=void 0!==a.infix?a.infix:"/json",this.timeoutPost=void 0!==a.timeoutPost?a.timeoutPost:6e4,this.timeoutGet=void 0!==a.timeoutGet?a.timeoutGet:5e3,this.responseFields=void 0!==a.responseFields?a.responseFields:["contents","navigation"]),this.locked=!1,this.absolutePath=null,this.containers=[],this.intermediateContainer=null,this.navigationListeners=[],this.eventNavigate={type:"navigate"},this.eventLoad={type:"load"},void 0===XMLHttpRequest)throw new Error("XHR not supported.");this.xhr=new XMLHttpRequest,this.xhr.addEventListener("readystatechange",function(a){b.handleResponse(this,a)}),this.xhr.addEventListener("timeout",function(a){b.handleTimeout(a)}),window.addEventListener("popstate",function(){b.handleBackForward()}),this.clickhandler=function(a){b.switchPage(this,a)}}var e=a("./eventdispatcher"),f="/";Stay.prototype=Object.create(e.prototype),Stay.prototype.constructor=Stay,Stay.prototype.navigate=function(a){var b,c,e;a.action?(this.absolutePath=a.action,b=new FormData(a)):this.absolutePath=a.href,c=d(this.absolutePath),this.locked=!0,e=c.pathname===f?this.absolutePath.slice(0,this.absolutePath.length-1)+this.infix+c.pathname:this.absolutePath.replace(c.pathname,this.infix+c.pathname),this.dispatchEvent(this.eventNavigate),b?(this.xhr.open("POST",e,!0),this.xhr.timeout=this.timeoutPost,this.xhr.send(b)):(this.xhr.open("GET",e,!0),this.xhr.timeout=this.timeoutGet,this.xhr.send())},Stay.prototype.updateView=function(a){var b,c,d,e;if(null===this.intermediateContainer)this.intermediateContainer=document.createElement("div");else for(;this.intermediateContainer.children.length>0;)this.intermediateContainer.removeChild(this.intermediateContainer.children[0]);for(b=0,c=this.responseFields.length;c>b;++b)if(d=this.containers[this.responseFields[b]],d||(d=this.containers[this.responseFields[b]]=document.getElementById(this.responseFields[b])),e=a[this.responseFields[b]]){for(;d.children.length>0;)d.removeChild(d.children[0]);for(this.intermediateContainer.innerHTML=e;this.intermediateContainer.children.length>0;)d.appendChild(this.intermediateContainer.children[0])}},Stay.prototype.switchPage=function(a,b){var c=!1;b.which?c=3===b.which:b.button&&(c=2===b.button),c||(b.preventDefault(),this.locked||this.navigate(a))},Stay.prototype.updateListeners=function(){var a,b,c=this,d=document.getElementsByTagName("a"),e=document.getElementsByTagName("form");for(a=0,b=this.navigationListeners.length;b>a;++a)this.navigationListeners[a][0].removeEventListener(this.navigationListeners[a][1],c.clickHandler);for(a=0,b=d.length;b>a;++a)d[a].addEventListener("click",c.clickHandler),this.navigationListeners.push([d[a],"click"]);for(a=0,b=e.length;b>a;++a)e[a].addEventListener("submit",c.clickHandler),this.navigationListeners.push([e[a],"submit"])},Stay.prototype.update=function(a){this.updateView(a),this.updateListeners(),a.url&&(this.absolutePath=a.url.replace(this.infix,"")),History&&History.pushState(null,a.title,this.absolutePath),this.dispatchEvent(this.loadEvent),this.locked=!1},Stay.prototype.handleResponse=function(a){var b={};if(0===this.responseFields.length)b.title="Setup Error",b[this.responseFields[0]]=Stay.Error.NO_RESPONSE_FIELDS;else if(4===a.readyState){if(404===a.status)b.title="Error "+a.status,b[this.responseFields[0]]=Stay.Error.NOT_FOUND;else if(0===a.status)b.title="Error",b[this.responseFields[0]]=Stay.Error.REFUSED;else if(200!==a.status)b.title="Error "+a.status,b[this.responseFields[0]]=Stay.Error.FAILED;else try{b=JSON.parse(a.responseText)}catch(c){b.title="Parse Error",b[this.responseFields[0]]=Stay.Error.UNPARSABLE,console.log(c)}b.url=a.responseURL,this.update(b)}},Stay.prototype.handleBackForward=function(){History&&!this.locked&&this.navigate({href:History.getState().url})},Stay.prototype.handleTimeout=function(){var a={title:"Timeout Error",contents:Stay.Error.TIMEOUT};this.locked=!0,this.update(a)},Stay.Error=Object.freeze({NOT_FOUND:"<h1>Error 404</h1><p>Not found.</p>",REFUSED:"<h1>Error</h1><p>The server doesn't respond.</p>",TIMEOUT:"<h1>Error</h1><p>The server didn't respond in time. Please try again later!</p>",FAILED:"<h1>Error</h1><p>The request failed.</p>",UNPARSABLE:"<h1>Parse Error</h1><p>The received content could not be parsed.</p>",NO_RESPONSE_FIELDS:"<h1>Internal Setup Error</h1><p>No response fields have been specified.</p>"}),b.exports=Stay},{"./eventdispatcher":1}]},{},[2])(2)});