/**
 * stay v0.1.0 build Sep 17 2015
 * https://github.com/vanruesc/stay
 * Copyright 2015 Raoul van Rueschen, Apache-2.0
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Stay=t()}}(function(){var t;return function e(t,i,n){function s(o,a){if(!i[o]){if(!t[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(r)return r(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var u=i[o]={exports:{}};t[o][0].call(u.exports,function(e){var i=t[o][1][e];return s(i?i:e)},u,u.exports,e,t,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(e,i,n){!function(e,s){"object"==typeof n&&"undefined"!=typeof i?i.exports=s():"function"==typeof t&&t.amd?t(s):e.EventDispatcher=s()}(this,function(){"use strict";function t(){this._listeners={}}return t.prototype.apply=function(e){e._listeners={},e.addEventListener=t.prototype.addEventListener,e.hasEventListener=t.prototype.hasEventListener,e.removeEventListener=t.prototype.removeEventListener,e.dispatchEvent=t.prototype.dispatchEvent},t.prototype.addEventListener=function(t,e){void 0===this._listeners[t]&&(this._listeners[t]=[]),-1===this._listeners[t].indexOf(e)&&this._listeners[t].push(e)},t.prototype.hasEventListener=function(t,e){return void 0!==this._listeners[t]&&-1!==this._listeners[t].indexOf(e)},t.prototype.removeEventListener=function(t,e){var i,n;n=this._listeners[t],void 0!==n&&(i=n.indexOf(e),-1!==i&&n.splice(i,1))},t.prototype.dispatchEvent=function(t){var e,i,n;if(n=this._listeners[t.type],void 0!==n)for(t.target=this,e=0,i=n.length;i>e;++e)n[e].call(this,t)},t})},{}],2:[function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function s(t){var e=document.createElement("a");return e.href=t,e}function r(t){var e=this;if(a["default"].call(this),this.local=new RegExp("^"+location.protocol+"//"+location.host),this.stderr=null,this.infix="/json",this.timeoutPost=6e4,this.timeoutGet=5e3,this.autoUpdate=!0,void 0!==t&&(void 0!==t.stderr&&(this.stderr=t.stderr),void 0!==t.infix&&(this.infix=t.infix),void 0!==t.timeoutPost&&(this.timeoutPost=t.timeoutPost),void 0!==t.timeoutGet&&(this.timeoutGet=t.timeoutGet),void 0!==t.autoUpdate&&(this.autoUpdate=t.autoUpdate)),this.locked=!1,this.backForward=!1,this.absolutePath=null,this.containers=[],this.intermediateContainer=null,this.navigationListeners=[],this.eventNavigate={type:"navigate"},this.eventReceive={type:"receive",response:null,status:0},this.eventLoad={type:"load"},void 0===XMLHttpRequest)throw new Error("XMLHttpRequest functionality not available.");this.xhr=new XMLHttpRequest,this.xhr.addEventListener("readystatechange",function(t){e._handleResponse(this,t)}),this.xhr.addEventListener("timeout",function(){var t={};t.title="Timeout Error",null!==e.stderr?t[e.stderr]=r.Error.TIMEOUT:console.error(r.Error.TIMEOUT),e.locked=!0,e.update(t)}),window.addEventListener("popstate",function(t){e.locked||null===t.state||(e.backForward=!0,e._navigate({href:t.state.url}))}),this._switchPage=function(t){var i=void 0!==t.preventDefault,n=!1;return"submit"===t.type?n=!0:t.metaKey||t.shiftKey||t.altKey||t.ctrlKey||(void 0!==t.which?n=1===t.which:void 0!==t.button&&(n=0===t.button)),n&&(i&&t.preventDefault(),e.locked||e._navigate(this)),!(n&&!i)},this.update({title:document.title,url:window.location.href}),this._updateListeners()}Object.defineProperty(i,"__esModule",{value:!0}),i["default"]=r;var o=t("@zayesh/eventdispatcher"),a=n(o);r.prototype=Object.create(a["default"].prototype),r.prototype.constructor=r,r.prototype._navigate=function(t){var e,i,n,r=!1;this.locked=!0,t.action?(this.absolutePath=t.action,e=new FormData(t),r=!0):this.absolutePath=t.href,i=s(this.absolutePath).pathname,"/"!==i.charAt(0)&&(i="/"+i),n="/"===i?this.absolutePath.slice(0,this.absolutePath.length-1)+this.infix+i:this.absolutePath.replace(new RegExp(i),this.infix+i),this.eventNavigate.method=r?"POST":"GET",this.dispatchEvent(this.eventNavigate),this.xhr.open(this.eventNavigate.method,n,!0),r?(this.xhr.timeout=this.timeoutPost,this.xhr.send(e)):(this.xhr.timeout=this.timeoutGet,this.xhr.send())},r.prototype._updateView=function(t){var e,i,n,s=!1;if(null===this.intermediateContainer)this.intermediateContainer=document.createElement("div");else for(;this.intermediateContainer.children.length>0;)this.intermediateContainer.removeChild(this.intermediateContainer.children[0]);for(e in t)if(i=this.containers[e],void 0===i&&(i=this.containers[e]=document.getElementById(e)),n=t[e],!n){for(;i.children.length>0;)i.removeChild(i.children[0]);for(this.intermediateContainer.innerHTML=n;this.intermediateContainer.children.length>0;)i.appendChild(this.intermediateContainer.children[0]);s=!0}s&&this._updateListeners()},r.prototype._updateListeners=function(){var t,e,i=this,n=document.getElementsByTagName("a"),s=document.getElementsByTagName("form");for(t=0,e=this.navigationListeners.length;e>t;++t)this.navigationListeners[t][0].removeEventListener(this.navigationListeners[t][1],i._switchPage);for(t=0,e=n.length;e>t;++t)this.local.test(n[t].href)&&(n[t].addEventListener("click",i._switchPage),this.navigationListeners.push([n[t],"click"]));for(t=0,e=s.length;e>t;++t)this.local.test(s[t].action)&&(s[t].addEventListener("submit",i._switchPage),this.navigationListeners.push([s[t],"submit"]))},r.prototype.update=function(t){this._updateView(t),document.title=t.title,t.url&&(this.absolutePath=t.url.replace(this.infix,"")),this.backForward?this.backForward=!1:history.pushState({url:this.absolutePath},t.title,this.absolutePath),this.eventReceive.response=null,this.dispatchEvent(this.eventLoad),this.locked=!1},r.prototype._handleResponse=function(t){var e={};if(4===t.readyState){try{e=JSON.parse(t.responseText)}catch(i){e.title="Parse Error",null!==this.stderr&&(e[this.stderr]=r.Error.UNPARSABLE),console.error(r.Error.UNPARSABLE,i)}e.url=t.responseURL,this.eventReceive.status=t.status,this.eventReceive.response=e,this.dispatchEvent(this.eventReceive),this.autoUpdate&&this.update(e)}},r.Error=Object.freeze({TIMEOUT:"<p>The server didn't respond in time. Please try again later!</p>",UNPARSABLE:"<p>The received content could not be parsed.</p>"}),e.exports=i["default"]},{"@zayesh/eventdispatcher":1}]},{},[2])(2)});